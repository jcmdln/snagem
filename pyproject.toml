# SPDX-License-Identifier: AGPL-3.0-or-later

[build-system]
build-backend = "poetry.core.masonry.api"
requires = ["poetry-core>=1.0.8"]

[tool.poetry]
authors = ["Johnathan C. Maudlin <jcmdln@gmail.com>"]
description = ""
license = "AGPL-3.0-or-later"
name = "snagem"
packages = [{ include = "snag" }, { include = "snagd" }]
readme = "README.md"
repository = "https://github.com/jcmdln/snagem"
version = "0.1.0"

[tool.poetry.dependencies]
python = "^3.7"
# snagem dependencies
alembic = "^1.7.6"
celery = "^5.2.3"
click = "^8.0.4"
cryptography = "^36.0.1"
datetime = "^4.4"
fastapi = "^0.74.1"
filelock = "^3.6.0"
humanfriendly = "^10.0"
itsdangerous = "^2.1.0"
jinja2 = "^3.0.3"
kombu = "^5.2.4"
orjson = "^3.6.7"
pydantic = "^1.8.2"
python-dateutil = "2.8.2"
python-multipart = "0.0.5"
pyyaml = "^6.0"
redis = "^4.1.4"
requests = "^2.27.1"
uvicorn = "^0.17.5"
youtube_dl = "*"

# FIXME: https://github.com/pypa/setuptools/pull/2872
# FIXME: When resolved, remember to purge sqlalchemy types as they aren't needed in v2
psycopg2 = "^2.9.3"
sqlalchemy = "^1.4.32"
#psycopg = "^3.0.10"
#sqlalchemy = { git = "https://github.com/sqlalchemy/sqlalchemy", rev = "c2fe4a2" }

[tool.poetry.group.bandit.dependencies]
bandit = "^1.7.0"
toml = "*"

[tool.poetry.group.coverage.dependencies]
coverage = "^6.3.1"

[tool.poetry.group.flake8.dependencies]
black = "^22.1.0"
flake8 = "^4.0.1"
flake8-black = "^0.2.4"
flake8-docstrings = "^1.6.0"
flake8-isort = "^4.0.2"
isort = "^5.10.1"
mccabe = "*"
pycodestyle = "*"
pydocstyle = "*"
pyflakes = "*"

[tool.poetry.group.lsp.dependencies]
pyls-flake8 = "^0.4.0"
pyls-isort = "^0.2.2"
pylsp-mypy = "^0.5.7"
pylsp-rope = "^0.1.8"
python-lsp-black = "^1.1.0"
python-lsp-server = { version = "^1.3.3", extras = [
    "mccabe",
    "pycodestyle",
    "pydocstyle",
    "pyflakes",
    "rope",
] }

[tool.poetry.group.pytest.dependencies]
pytest = "^7.0.0"

[tool.poetry.group.mypy.dependencies]
mypy = ">=0.941"
types-click = "^7.1.8"
types-cryptography = "^3.3.15"
types-humanfriendly = "^9.2.4"
types-itsdangerous = "^1.1.6"
types-jinja2 = "^2.11.9"
types-orjson = "^3.6.2"
types-pyyaml = "^6.0.4"
types-redis = "^4.1.17"
types-requests = "^2.27.11"
# Plugins
sqlalchemy = "*"

# FIXME: https://github.com/pypa/setuptools/pull/2872
# FIXME: When resolved, remember to purge sqlalchemy types as they aren't needed in v2
sqlalchemy2-stubs = "*"

[tool.poetry.group.tox.dependencies]
tox = "^3.24.5"

[tool.poetry.scripts]
snag = "snag.main:main"
snagd = "snagd.main:main"

#
# Tools
#

[tool.bandit]
ignore = ["101"]

[tool.black]
line-length = 99

[tool.isort]
line_length = 99
lines_between_types = 1
profile = "black"
remove_redundant_aliases = true
wrap_length = 99

[tool.mypy]
ignore_missing_imports = true
plugins = ["sqlalchemy.ext.mypy.plugin"]
show_error_context = true
strict = true
strict_optional = true
# Disable specific '--strict' and '--strict_optional' checks
disallow_any_generics = false
disallow_subclassing_any = false
disallow_untyped_calls = false
disallow_untyped_decorators = false
